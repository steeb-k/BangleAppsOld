// Custom Cantarell Bold font
Graphics.prototype.setFontCantarellBold = function() {
  return this.setFontCustom(
    atob('AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/8AAAAAAAAAAAAAP/8AAAAAAAAAAAAAP/8AAAAAAAAAAAAAP/8AAAAAAAAAAAAAP/8AAAAAAAAAAAAAP/8AAAAAAAAAAAAAP/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHwAAAAAAAAAAAAAL/wAAAAAAAAAAAAL//wAAAAAAAAAAAL///wAAAAAAAAAAb////wAAAAAAAAAb/////wAAAAAAAAb/////9AAAAAAAAb/////9AAAAAAAAb/////5AAAAAAAAf/////5AAAAAAAAf/////5AAAAAAAAf/////5AAAAAAAAD/////5AAAAAAAAAD////5AAAAAAAAAAD///4AAAAAAAAAAAD//4AAAAAAAAAAAAD/0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAG///5AAAAAAAAAAH/////4AAAAAAAAA///////gAAAAAAAH///////8AAAAAAAf////////QAAAAAA/////////wAAAAAD//+QABf//8AAAAAH//gAAAA//9AAAAAP/9AAAAAH//AAAAAf/0AAAAAB//QAAAAv/wAAAAAA//gAAAA//QAAAAAAf/wAAAA//AAAAAAAP/wAAAA//AAAAAAAL/wAAAA//AAAAAAAL/wAAAA//AAAAAAAL/wAAAA//AAAAAAAP/wAAAA//QAAAAAAf/wAAAAv/wAAAAAA//gAAAAP/4AAAAAC//AAAAAP/+AAAAAL//AAAAAH//0AAAB//9AAAAAC///kABv//4AAAAAA/////////wAAAAAAP////////AAAAAAAD///////8AAAAAAAAv//////QAAAAAAAAC/////0AAAAAAAAAAFv//kAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAA/QAAAAAAFVQAAAAB/9AAAAAAL/wAAAAC/9AAAAAAL/wAAAAD/8AAAAAAL/wAAAAH/4AAAAAAL/wAAAAP/0AAAAAAL/wAAAAP/wAAAAAAL/wAAAAv/gAAAAAAL/wAAAA//QAAAAAAL/wAAAA///////////wAAAA///////////wAAAA///////////wAAAA///////////wAAAA///////////wAAAA///////////wAAAA///////////wAAAAAAAAAAAAAL/wAAAAAAAAAAAAAL/wAAAAAAAAAAAAAL/wAAAAAAAAAAAAAL/wAAAAAAAAAAAAAL/wAAAAAAAAAAAAAL/wAAAAAAAAAAAAAL/wAAAAAAAAAAAAAL/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC9AAAAAAAAFQAAAAD/4AAAAAAH/wAAAAH/0AAAAAB//wAAAAP/wAAAAAL//wAAAAP/wAAAAB///wAAAAf/gAAAAH///wAAAAv/QAAAAv///wAAAAv/AAAAB////wAAAA//AAAAH////wAAAA/+AAAAf/+L/wAAAA/+AAAA//0L/wAAAA/+AAAD//QL/wAAAA/+AAAL/9AL/wAAAA/+AAAf/0AL/wAAAA//AAA//gAL/wAAAA//AAC//AAL/wAAAAv/gAH/8AAL/wAAAAL/0Af/0AAL/wAAAAP/9B//gAAL/wAAAAH/////AAAL/wAAAAC////0AAAL/wAAAAA////QAAAL/wAAAAAP//9AAAAL/wAAAAAC//gAAAAL/wAAAAAABQAAAAAL/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAB0AAAAAAAG/QAAAAD/kAAAAAAP/gAAAAH/8AAAAAAP/wAAAAL/0AAAAAAP/0AAAAP/wAAAAAAL/4AAAAf/gAAAAAAH/4AAAAv/QABVQAAD/8AAAAv/AAL/wAAD/8AAAA//AAL/wAAD/8AAAA//AAL/wAAD/8AAAA//AAP/0AAD/8AAAA//AAP/0AAD/8AAAA//AAP/4AAD/8AAAA//QAv/8AAH/4AAAAv/gA//8AAP/0AAAAf/0D//+AAf/wAAAAP//////QA//wAAAAL//////4H//QAAAAD//////////AAAAAC////f////9AAAAAAv//9L////0AAAAAAH//wD////QAAAAAAAakAAv//9AAAAAAAAAAAAG//QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAL/AAAAAAAAAAAAAB//AAAAAAAAAAAAAL//AAAAAAAAAAAAB///AAAAAAAAAAAAL///AAAAAAAAAAAB////AAAAAAAAAAAP////AAAAAAAAAAC/////AAAAAAAAAAf//9v/AAAAAAAAAC///gv/AAAAAAAAAf//8Av/AAAAAAAAC///QAv/AAAAAAAAf//4AAv/AAAAAAAD///QAAv/AAAAAAAf//4AAAv/AAAAAAA///QAAAv/AAAAAAA//+qqqq//AAAAAAA///////////wAAAA///////////wAAAA///////////wAAAA///////////wAAAA///////////wAAAA///////////wAAAAAAAAAAAv/AAAAAAAAAAAAAAv/AAAAAAAAAAAAAAv/AAAAAAAAAAAAAAv/AAAAAAAAAAAAAAv/AAAAAAAAAAAAAAv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAb/QAAAA/////9AAAv/QAAAA/////9AAAf/gAAAA/////8AAAP/gAAAA/////8AAAP/wAAAA/////8AAAP/wAAAA/////8AAAP/wAAAA/+VX/8AAAP/wAAAA/+AD/4AAAP/wAAAA/+AD/4AAAL/wAAAA/+AD/4AAAP/wAAAA/+AD/8AAAP/wAAAA/+AD/8AAAP/wAAAA/+AD/8AAAP/wAAAA/+AD/8AAAf/wAAAA/+AD/+AAAv/gAAAA/+AC//AAA//QAAAA/+AB//QAB//AAAAA/+AA//0AH//AAAAA/+AAv/+Av/9AAAAA/+AAf/////8AAAAA/+AAL/////0AAAAA/+AAD/////QAAAAA/+AAA////9AAAAAA/+AAAL///0AAAAAAAAAAABv/9AAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABVQAAAAAAAAAAAAv///5AAAAAAAAAAf/////0AAAAAAAAH///////AAAAAAAAv///////wAAAAAAD////////8AAAAAAP/////v//9AAAAAAv////gAf//AAAAAA//3/9AAD//QAAAAD//D/4AAA//gAAAAD/8L/wAAAf/wAAAAL/0P/gAAAP/wAAAAP/wP/gAAAL/wAAAAf/gP/QAAAH/wAAAAv/QP/QAAAH/wAAAAv/AP/gAAAL/wAAAA//AP/wAAAP/wAAAA//AP/0AAAf/gAAAA/+AL/8AAA//QAAAA/+AH/+AAD//AAAAA/+AD//0Af/9AAAAA/+AC//////8AAAAA/+AA//////wAAAAA//AAP/////QAAAAAupAAD////8AAAAAAAAAAAv///gAAAAAAAAAAAC//kAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVVAAAAAAAAAAAAAA//AAAAAAAAAAAAAA//AAAAAAAAAAAAAA//AAAAAAAAAAAAAA//AAAAAAAAAQAAAA//AAAAAAAAHwAAAA//AAAAAAAAvwAAAA//AAAAAAAH/wAAAA//AAAAAAB//wAAAA//AAAAAAL//wAAAA//AAAAAB///wAAAA//AAAAAf///gAAAA//AAAC///4AAAAA//AAAAf///QAAAAA//AAAH///4AAAAAA//AAAv//+AAAAAAA//AAH///0AAAAAAA//AB///9AAAAAAAA//AL///gAAAAAAAA//B///8AAAAAAAAA//f///QAAAAAAAAA/////4AAAAAAAAAA////+AAAAAAAAAAA////0AAAAAAAAAAA///9AAAAAAAAAAAA///gAAAAAAAAAAAA//9AAAAAAAAAAAAA//QAAAAAAAAAAAAA/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABv+QAAAAAAAAAAAAP//8AAAAAAAC/+AB////AAAAAAAf//0H////wAAAAAB///9P////4AAAAAD/////////9AAAAAL//////gf//AAAAAP/////8AD//AAAAAf/4L//wAA//QAAAAv/gC//QAAv/gAAAA//AA/+AAAP/wAAAA/+AAv9AAAP/wAAAA/+AAP8AAAL/wAAAA/9AAP8AAAL/wAAAA/+AAL9AAAL/wAAAA/+AAP+AAAL/wAAAA//AAf/AAAP/wAAAA//QA//gAAP/wAAAAv/0D//wAAv/gAAAAf/////4AB//QAAAAP//////QL//AAAAAH/////////9AAAAAD///9f////8AAAAAA///0P////0AAAAAAH//QD////QAAAAAAAWQAAv//9AAAAAAAAAAAAH//QAAAAAAAAAAAAAFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/+QAAAAAAAAAAAA///8AAAAAAAAAAAH////QAAGrgAAAAAf////0AAP/wAAAAB/////8AAL/wAAAAD/////+AAL/wAAAAH//QL//AAL/wAAAAP/4AC//QAL/wAAAAf/wAA//gAL/wAAAAv/QAAP/wAP/wAAAA//AAAP/wAP/wAAAA/+AAAL/wAP/gAAAA/9AAAH/wAf/gAAAA/9AAAH/wAv/QAAAA/+AAAL/wA//AAAAA//AAAL/wC/+AAAAA//AAAP/gH/9AAAAAv/wAAf/Av/8AAAAAf/4AA//H//0AAAAAP/+AH/////gAAAAAH//+//////AAAAAAD////////8AAAAAAA////////gAAAAAAAP//////9AAAAAAAAB//////gAAAAAAAAAG////kAAAAAAAAAAABVVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//wAAAP/8AAAAAAA//wAAAP/8AAAAAAA//wAAAP/8AAAAAAA//wAAAP/8AAAAAAA//wAAAP/8AAAAAAA//wAAAP/8AAAAAAA//wAAAP/8AAAAAAAAAAAAAAAAAAA'),
    46,
    atob("CxIhHyAfISAfICAgCw=="),
    48|131072
  );
};

function drawTextWithOutline(text, x, y, textColor, outlineColor) {
    g.setColor(outlineColor);
    [-1, 0, 1].forEach(dx => {
      [-1, 0, 1].forEach(dy => {
        if (dx || dy) g.drawString(text, x + dx, y + dy);
      });
    });
    g.setColor(textColor);
    g.drawString(text, x, y);
  }
  

// Wallpapers
var lightWallpaper = require("heatshrink").decompress(atob("2Gw4X/pNBtmZtO5wXSD6cBqoAFrWqAAOv/4AJJigrGqwrC1YrfiosGFYWqFb8FFY1qFYW/FbyEHWBwrVQgywOFaqEHFccBWBQrnWAYrfbhYrgbhW/Fb7cGFd6Dgbgwr/ACIr/Fa8VFeerFf4r/FddaFduqFf4rX14rqLBIriLBAriLBArXFQgrGLA4rj1YrqQg4rdqwrF34rjqorjgIrGbhgreLAormWIgrmqtqFYWrFcxYDFc6xEFbkFFZKED34rmrTcIFcKwJFcKwEQgjbhFYgsEFcTcDWQgroFoQrWgArS1QrXiorJrQrfgorqWBVWFb6EKFcJYKFcCxKtQrggDcQFbRYIWA4raLBIriLBCEGFbZYJboorciosNFbiEIQworcgIrJLQYrcWBIAEFf7cTFcLcKFf4AMgIr/AC4r/Ff4ADior/AC0FFf4AWgIr/AC4rrior/AC0FFdTcLoCEqqCEqqgrfgCwqLBawgWJSwgQpYrhLJKEhWZKEiQ5IrkFoxYlAAWVWIy+CXEGlbwi7EqgrkXE2qFZSEf1SwDFc6EKqArf1IrqQhVUFcCEJFcOqEwdWLwYriWIVqAolVFcIAGFdaECFddAFc+lFf4rW1IrtqAr/Ff+qFYNUFf4r/FYVVFdGVFdtAFc+lFdtQFc+pFYNUFdTcdFZWqFYSwcFZeVWDwrLbgSEcFZawDQjYrLWAdUFc6wCLDfqQh5Ya/yEPbrX/FZmlFYVQFbKEq/6ENbrn///614vKQjgrBAAaElFYq0JFYVVFf4rJ/TckFZ7cbFabcXFYv+FZGpFdTcbFajcWFYv/FZOVFd1QFc2lFcHqFZlUFbn6FdX+FZGpFYVVFbiEJFcSEJFcP/FZlAFbqEIFcTdIFcSEIyorCqAreQg4r/FZ/6FdTcH0orCqgr/FZX/Ff4riqorf9Qrx1Ir/FZ/6Ff4rioAr/FfuqFcf+Ff4ALA=="))
var darkWallpaper = require("heatshrink").decompress(atob("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"))

// Watchface draw function
function drawWatchFace() {
  var date = new Date();
  var hours = date.getHours();
  var minutes = date.getMinutes();

  // Use system theme to determine wallpaper and text color
  var isDarkMode = g.theme.bg < 0x7FFF;

  // Clear and draw background
  g.clear();
  g.drawImage(isDarkMode ? darkWallpaper : lightWallpaper, 0, 0);

  // Set custom font and text color
  g.setFontCantarellBold();
  g.setColor(isDarkMode ? 0xFFFF : 0x0000); // white on dark, black on light

  // Format time as HH:MM
  var timeStr = (" " + hours).substr(-2) + ":" + ("0" + minutes).substr(-2);
  var timeWidth = g.stringWidth(timeStr);
  var timeY = 90; // Adjust based on your font's height
  var timeX = (g.getWidth() - timeWidth) / 2;
  drawTextWithOutline(
    timeStr,
    timeX,
    timeY,
    isDarkMode ? 0xFFFF : 0x0000,
    isDarkMode ? 0x0000 : 0xFFFFFF
  );

  // Format date as "Month Day, Year"
  var months = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
  var dateStr = months[date.getMonth()] + " " + date.getDate() + ", " + date.getFullYear();

  // Draw date using a smaller system font
  g.setFont("6x8", 2); // medium-size built-in font
  g.setColor(isDarkMode ? 0xAAAA : 0x0000); // dimmer or same as time text
  var dateWidth = g.stringWidth(dateStr);
  g.drawString(dateStr, (g.getWidth() - dateWidth) / 2, timeY + 40); // draw below the time
}

// Set up redraw every minute
Bangle.on('lcdPower', function(on) {
  if (on) drawWatchFace();
});
setInterval(drawWatchFace, 60000);
drawWatchFace();

// Prevent widgets from drawing over the watchface
Bangle.loadWidgets();
Bangle.drawWidgets();
